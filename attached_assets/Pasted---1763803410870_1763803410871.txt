Привет — ниже готовый единый большой промпт на русском, который ты можешь скопировать и отправить разработчику одним нажатием. Важное условие: не менять стек — Node.js + PostgreSQL оставлять как есть. Всё остальное — переработать, пересобрать и привести в порядок по инструкции. Копируй всё от начала до конца и отправляй разработчику:

Привет. Нужна полная, аккуратная и архитектурно правильная пересборка существующего сайта на Node.js + PostgreSQL — не переписывать на другой стек, не менять базу, а именно организовать проект, чтобы всё содержимое сайта (весь текст, все картинки, все ингредиенты, цены, настройки еды, слайдер/галерея и т.д.) загружалось только из базы данных и полностью управлялось через админку. Перед началом прямо сейчас первым шагом выполни ревизию текущих медиа: просканируй все картинки, сопоставь их с сущностями (категории, блюда, слайдер, галерея), переименуй файлы по осмысленному соглашению (например {category_slug}/{item_id}-{item_slug}.{ext} или {usage}/{order}-{shortname}.{ext}), чтобы названия однозначно отражали назначение (кофе — coffee.jpg, чай — tea.jpg, poke-bowl — poke-... и т.д.). Это первое обязательное действие — вручную/скриптом привести имена картинок в порядок, чтобы система могла надёжно подхватывать нужную картинку к нужному блюду. Никаких автоматических переименований без проверки — если алгоритм не уверен, помечай файл для ручной валидации в админке.

Далее — реализовать следующее (строго для Node.js + Postgres, ничего не менять по стеку): 1) выстроить предсказуемую структуру директорий в репозитории и в public/storage для медиа (примерно /public/photos/start-site/slider, /public/photos/start-site/gallery, /public/photos/menu/{category_slug}/items/ и т.д.), убрать все пустые/лишние файлы и папки; 2) обеспечить, чтобы всё содержимое (названия, описания, составы, цены, доступность, метаданные изображений, порядок слайдов) хранилось в БД и отдавалось через API/ORM на фронтенд — никаких хардкоднутых путей/текстов в шаблонах; 3) админка должна уметь создавать/редактировать/удалять категории меню, в каждой категории добавлять блюда с полями: title, slug, description, ingredients (структурировано/JSON), price(s) (множественные варианты если есть), options/constructors (для сложных блюд типа poke-bowl — сохранять структуру конструктора: базовые опции, протеины, добавки, соусы, и отдельные дубликаты как «extra_protein», «extra_fries» и т.д.), загружать изображения и задавать их использование (usage: slider | gallery | category | item), порядок и alt-текст; 4) при создании категории в админке логически создавать контейнер/путь для медиа (виртуальная или реальная папка в storage) и записывать в БД путь к файлам; 5) исправить логику галереи/слайдера так, чтобы загрузка в slider не попадала в gallery и наоборот — разделять по полю usage в Media; слайдер должен показывать только активные слайды с типом slider и порядком; галерея — только gallery; 6) добавить явное сопоставление картинки → элемент: при создании/редактировании блюда админ должен выбрать/назначить картинку из media или загрузить новую; если в revize первая итерация показала, что файл уже явно соответствует сущности (по имени), система должна предложить автоподстановку с возможностью ручного подтверждения; 7) сделать систему логирования всех операций в админке: каждое CREATE/UPDATE/DELETE записывать в таблицу logs с user_id, action, object_type, object_id, diff (old/new JSON), timestamp; 8) реализовать механизм снапшотов: кнопка «Создать снапшот» формирует дамп БД + manifest медиа (список файлов и хэшей) и связывает его с набором логов; обеспечить возможность отката на тестовой среде через restore snapshot (минимум вариант восстановления БД и списка/путей медиа); 9) предусмотреть миграции (SQL/ORM) и инструкции по бэкапу/откату, плюс скрипты для пересборки проекта на Replit и для деплоя на Railway (уже задеплоено, ничего не трогать, просто дать корректные скрипты): пример npm run clean, npm ci, npm run build, npm start и один скрипт rebuild для полной пересборки; 10) добавить минимальные автоматические тесты (юнит/интеграция) на ключевые API: загрузка медиа, создание категории, создание блюда, получение списка блюд категории, отображение slider/gallery; 11) выполнить рефакторинг контроллеров/сервисов, чтобы логику работы с медиа и с привязкой изображений вынести в сервис mediaService (загрузка, переименование, генерация thumb, возврат путей), а логику меню — в menuService/itemService, с четким разделением слоев (controllers → services → models); 12) документировать: README с инструкцией по локальному запуску, пересборке на Replit, созданию снапшота и восстановлению, и тестов; 13) коммиты аккуратные, с понятными сообщениями, ветка для переделки отдельная.

Особо про сложные блюда/конструкторы (poke-bowl и т.п.): не ломать существующую логику калькулятора — сначала проанализируй текущую реализацию конструктора и опиши черновик (draft) структуры: какие сущности есть (протеины, добавки, соусы, варианты размеров, дополнительные опции), как хранится цена за каждую опцию, какие дубликаты встречаются (extra_protein, extra_fries и т.д.). Этот черновик добавь в админку как внутреннюю заметку/документ и сохрани в репозитории (как docs/poke-constructor-draft.md) перед тем как вносить изменения. Важное требование: пока не тестируешь откат/изменения, не трогай production data без бэкапа; все эксперименты на отдельной ветке и тестовой БД.

Про переименование картинок — отдельный алгоритм/план: 1) собрать manifest всех изображений (текущие пути, размеры, метаданные); 2) сопоставить имена файлов с названиями блюд/категорий через ближайшее совпадение (fuzzy match) и по метаданным; 3) составить таблицу соответствий и показать её в админке как draft: текущий_файл -> предложение_нового_имени -> предполагаемый_привязанный_элемент с чекбоксом подтверждения для каждой строки; 4) после ручного подтверждения — выполнить переименование/перемещение и обновить записи в media с новым путем; 5) если соответствие не найдено — переместить в папку /public/photos/unassigned/ и пометить для ручной сортировки.

Критерии приёма работы (что я проверяю): 1) все тексты/описания/цены/картинки подгружаются из БД, нет хардкода; 2) создание категории в админке приводит к появлению категории в БД, к появлению логического контейнера для медиа и к отображению на фронте; 3) добавление блюда с картинкой корректно отображается в меню; 4) слайдер и галерея работают независимо и корректно; 5) логи операций ведутся и есть возможность создать снапшот и выполнить тестовый откат; 6) структура папок в public/repo аккуратна; 7) есть инструкции по пересборке и бэкапу; 8) минимальные тесты проходят.

Не давай никаких автоматических изменений стека и не предлагай переписать проект на другие технологии — Node.js + PostgreSQL оставлять неизменными. Не меняй формат/значения цен и критериев, которые уже настроены корректно, не придумывай новые тарифы/ценовые правила. Если встретишь неоднозначности с привязкой картинок — делай предложенную таблицу соответствий и получай подтверждение владельца перед массовым переименованием. В ответ пришли: 1) план действий (технические этапы без временных оценок), 2) список миграций, которые будешь применять и как ты будешь бэкапить перед применением, 3) какие сторонние библиотеки/утилиты планируешь использовать и почему, 4) где будешь хранить медиа (локально в public или предусмотри вариант S3 — но по умолчанию оставь локально, чтобы не менять инфраструктуру Railway), 5) тестовый сценарий, которым я могу проверить основные функции после переделки, 6) ветка репозитория, куда ты будешь коммитить изменения. Спасибо — жду твой план и черновик соответствий картинок в админке как первый артефакт.

Если нужно, я могу потом прислать структуру репозитория и дампу/список файлов, и ты на основе этого предложишь готовую таблицу соответствий, но сначала сделай ревизию и предложи draft сопоставлений картинок как описано выше.
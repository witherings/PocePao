# URGENT: FINAL DEPLOYMENT PREPARATION (RAILWAY COMPATIBLE)

I am preparing the final deploy for the customer today. This is the absolute deadline. Everything must work perfectly on Railway. Please read this entire request carefully. Your goal is to implement these changes robustly, self-correct if you see logical gaps, and ensure the app works "smooth like butter."

**CONTEXT:**
We are finalizing the "Wunschbowl" (Custom Bowl) logic, cleaning up the Standard Menu, and adding critical production features (Maintenance Mode, Mobile UX).

---

### PART 1: WUNSCHBOWL (CUSTOM BOWL) REFACTORING

**1.1 Frontend - Limit Update (Frische Zutaten)**
* **Requirement:** Change the selection limit for "Frische Zutaten" (Fresh Ingredients) from 4 to **5**.
* **Action:** Update the validation logic and UI counters on the frontend immediately.

**1.2 Database Schema Update (Critical)**
* **Current State:** The system uses a fixed price on the Dish level. This is wrong.
* **Required Change:** Update the `Ingredient` (or `Protein`) model in the database (Prisma/Schema) to support dual pricing and a new category.
    * Add column: `price_small` (Decimal/Float) - Price when bowl size is "Klein".
    * Add column: `price_standard` (Decimal/Float) - Price when bowl size is "Standard".
    * Update `type` enum/column to support a new value: `'EXTRA'`.

**1.3 Admin Panel - Smart Ingredient Modal**
* **Logic:** When adding/editing an ingredient in the Admin Panel:
    * If **Type is "Protein"**: Hide the single "Price" field. Show **TWO** fields: "Price (Klein)" and "Price (Standard)".
    * If **Type is "Extra"**: Show **ONE** field: "Price (€)".
    * If **Type is Base/Sauce/Marinade**: Hide price fields (unless they have a specific surcharge, but generally they are included).
* **Action:** Ensure the Admin UI conditionally renders these inputs based on the selected Type.

**1.4 Frontend - User Flow & Pricing Logic**
* **The Math:** `Total Price = (Protein_Price_For_Selected_Size) + (Sum_of_All_Extras)`.
    * *Note:* Remove any "Base Dish Price" from the calculation. The base cost is strictly derived from the Protein + Size combination.
* **Step 1 (Size):** The user MUST select **Klein** or **Standard** *before* seeing ingredients.
* **Step 2 (Protein):** Display Proteins. Their displayed price must update dynamically based on the Size selected in Step 1. (e.g., Chicken shows €9.50 if Klein, €14.50 if Standard).
* **Step 3 (Extras):** Show the "Extra" category. These items have their own independent fixed prices (from Admin). They are additive to the total.

---

### PART 2: STANDARD MENU CONSOLIDATION

**Context:** We need to merge duplicate dishes (e.g., "Chicken Bowl with Rice", "Chicken Bowl with Quinoa") into single entries.

**2.1 Admin Configuration**
* In the Dish Editor for standard items, add a toggle: **"Enable Base Selection"**.

**2.2 Frontend Logic**
* If a Dish has "Enable Base Selection" ON:
    * Force the user to select a Base before adding to cart.
    * **Options (Hardcoded German):** Reis, Quinoa, Zucchini-Nudeln, Couscous.
    * **Placement:** Display this selector near the Size selector.
* **Pricing:** Changing the Base does NOT change the price. Only the Size (Klein/Standard) changes the price.

**2.3 Cart & Order Data**
* The selected Base must be saved as a string note/variation (e.g., "Bowl Name - Size: Standard, Base: Quinoa") so the kitchen sees it in the Admin Dashboard.

---

### PART 3: GLOBAL MAINTENANCE MODE & ADMIN ACCESS

**3.1 Admin Switch**
* Add a global toggle in Admin Settings: **"Enable Maintenance Mode"**.

**3.2 The Overlay**
* When enabled, a **Full-Screen Overlay** must block **ALL** public routes (`/`, `/menu`, `/reservation`, etc.).
* **Visuals:** Use the site's primary blue brand color.
* **Text:** Center-aligned: *"Hoppla! Die Seite ist vorübergehend nicht verfügbar. Wir sind bald wieder für Sie da!"*

**3.3 The Admin Backdoor (Crucial)**
* Since the footer is covered by the overlay, you must add a specific **access point** on the overlay itself.
* **Requirement:** Place a small, discreet dot or "Admin Login" text link in the **bottom-right corner** of the Maintenance Overlay.
* **Behavior:** Clicking this link navigates to `/admin`. Ensure the `/admin` route is **NOT** blocked by the overlay so the owner can log in and disable Maintenance Mode.

---

### PART 4: MOBILE CART UX

**Issue:** Custom bowls take up too much vertical space in the cart on mobile.

**Requirement:** Implement a **Collapsible/Accordion** view for "Wunschbowl" items in the cart.
* **Default:** Show only Name ("Wunschbowl"), Size, and Total Price.
* **Action:** Add a "Details anzeigen" (Show details) toggle.
* **Expanded:** Show the full list of ingredients (Base, Protein, Sauces, Extras) only when expanded.

---

### EXECUTION INSTRUCTIONS

1.  **Database:** Apply schema changes first.
2.  **Backend:** Update API endpoints to handle the new price fields and order variations.
3.  **Frontend:** Implement the new flow (Size -> Protein), the Maintenance Overlay, and the Mobile Cart Accordion.
4.  **Railway Compatibility:** Ensure all changes work in a production environment (check build process).
5.  **Sanity Check:** Verify that setting a price in Admin immediately reflects on the Frontend and that the Math is 100% correct.

**GO! Make it perfect.**
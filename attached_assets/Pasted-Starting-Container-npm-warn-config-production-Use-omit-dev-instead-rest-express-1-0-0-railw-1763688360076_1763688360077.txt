Starting Container
npm warn config production Use `--omit=dev` instead.
> rest-express@1.0.0 railway:start
> npm run db:migrate; npm run db:seed; npm run db:create-admin || true; npm run start
npm warn config production Use `--omit=dev` instead.
> rest-express@1.0.0 db:migrate
> tsx server/migrate.ts
üîÑ Running database migrations...
üöÇ Railway environment detected, waiting for private network initialization...
üîÑ Connection attempt 1/5...
üîå Attempting database connection to: postgresql://postgres:****@switchback.proxy.rlwy.net:44317/railway
‚úÖ Database connection successful!
üìù Migrating menu_items table...
  ‚úì price_small exists
  ‚úì enable_base_selection exists
üìù Migrating ingredients table...
  ‚úì price_small exists
  ‚úì price_standard exists
üìù Ensuring app_settings table exists...
  ‚úì app_settings table exists
üîç Verifying schema...
  ‚úì menu_items.price_small
  ‚úì menu_items.enable_base_selection
  ‚úì ingredients.price_small
  ‚úì ingredients.price_standard
‚úÖ Schema verification passed!
‚úÖ All migrations completed successfully!
npm warn config production Use `--omit=dev` instead.
> rest-express@1.0.0 db:seed
> tsx server/seed.ts
üå± Starting database seeding...
üöÇ Railway environment detected, waiting for private network initialization...
üîå Attempting database connection to: postgresql://postgres:****@switchback.proxy.rlwy.net:44317/railway
üîÑ Connection attempt 1/5...
‚úÖ Database connection successful!
‚ö†Ô∏è  Database already has data. Skipping seed to preserve existing data.
   Found 6 categories.
npm warn config production Use `--omit=dev` instead.
> rest-express@1.0.0 db:create-admin
> tsx server/create-admin.ts
üîê Creating admin user...
üöÇ Railway environment detected, waiting for private network initialization...
üîå Attempting database connection to: postgresql://postgres:****@switchback.proxy.rlwy.net:44317/railway
üîÑ Connection attempt 1/5...
‚úÖ Database connection successful!
‚ö†Ô∏è  Admin user already exists. Skipping admin creation.
   Username: admin
npm warn config production Use `--omit=dev` instead.
> rest-express@1.0.0 start
> NODE_ENV=production tsx server/index.ts
üöÇ Railway environment detected, waiting for private network initialization...
üîå Attempting database connection to: postgresql://postgres:****@switchback.proxy.rlwy.net:44317/railway
üîÑ Connection attempt 1/5...
‚úÖ Database connection successful!
‚úÖ Admin user already exists
1:18:05 AM [express] serving on port 8080
1:18:07 AM [express] GET /api/health 200 in 14ms
1:18:15 AM [express] GET /api/settings 304 in 23ms :: {"maintenanceMode":0}
1:18:15 AM [express] GET /api/static-content/home 404 in 24ms :: {"error":"Content not found"}
1:18:15 AM [express] GET /api/gallery 500 in 193ms :: {"error":"Failed to fetch gallery images"}
1:18:32 AM [express] POST /api/admin/login 200 in 154ms :: {"success":true,"user":{"id":"fb0eaa81-c6‚Ä¶
1:18:32 AM [express] GET /api/admin/me 200 in 14ms :: {"id":"fb0eaa81-c657-48bc-b636-964d313d4056","‚Ä¶
1:18:33 AM [express] GET /api/admin/snapshots 200 in 29ms :: [{"id":"bf1b8755-a433-4011-b938-14c4333‚Ä¶
1:18:34 AM [express] DELETE /api/admin/snapshots/bf1b8755-a433-4011-b938-14c4333c716b 200 in 19ms ::‚Ä¶
1:18:34 AM [express] GET /api/admin/snapshots 200 in 16ms :: []
Error creating snapshot: error: relation "snapshot_ingredients" does not exist
    at /app/node_modules/pg-pool/index.js:45:11
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async <anonymous> (/app/server/snapshot-routes.ts:78:9) {
  length: 119,
  severity: 'ERROR',
  code: '42P01',
  detail: undefined,
  hint: undefined,
  position: '13',
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'parse_relation.c',
  line: '1449',
  routine: 'parserOpenTable'
}
1:18:41 AM [express] POST /api/admin/snapshots 400 in 58ms :: {"error":"relation \"snapshot_ingredie‚Ä¶
1:18:47 AM [express] GET /api/gallery 500 in 50ms :: {"error":"Failed to fetch gallery images"}
1:18:55 AM [express] GET /api/categories 200 in 20ms :: [{"id":"98ad7c95-5940-4d69-8b10-13ab682ef305‚Ä¶
‚ùå Error fetching menu items: error: column "has_variants" does not exist
    at /app/node_modules/pg-pool/index.js:45:11
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async <anonymous> (/app/node_modules/src/node-postgres/session.ts:104:19)
    at async DatabaseStorage.getAllMenuItems (/app/server/storage.ts:135:12)
    at async <anonymous> (/app/server/routes.ts:95:25) {
  length: 113,
  severity: 'ERROR',
  code: '42703',
  detail: undefined,
  hint: undefined,
  position: '273',
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'parse_relation.c',
  line: '3716',
  routine: 'errorMissingColumn'
}
Stack: error: column "has_variants" does not exist
    at /app/node_modules/pg-pool/index.js:45:11
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async <anonymous> (/app/node_modules/src/node-postgres/session.ts:104:19)